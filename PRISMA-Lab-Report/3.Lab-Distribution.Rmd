---
title: "Lab Report - Lab distribution"
date: "Issued: `r Sys.Date()`"
output:
  pdf_document:
    toc: no
    toc_depth: 5
    number_sections: true
    latex_engine: xelatex
    keep_tex: true
---

**Date of included data upload to Synapse: ** 2024-06-14

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, out.width = "100%", fig.align = "center") 

library(tidyverse)
library(wesanderson)
library(gt)
library(scales)
library(ggbreak)
library(naniar)

load("derived_data/df_lab.rda")
load("derived_data/df_lab_06_l.rda")
load("derived_data/df_lab_08_l.rda")

#define table format 
tb_theme2 <- function(matrix){
  tb <- matrix %>% 
    gt(
      rownames_to_stub = TRUE
    ) %>% 
    opt_align_table_header(align = "left") %>% 
    tab_spanner(
      label = "Site",
      columns = c(-Total)
    ) %>% 
    opt_stylize(style = 6, color = 'cyan') %>% 
    tab_style(
      style = list(
        cell_fill(color = "#016795"),
        cell_text(weight = "bold"),
        cell_text(v_align = "middle"),
        cell_text(color = "white")
      ),
      locations = list(
        cells_title()
      )
    ) %>% 
    tab_style(
      style = list(
        cell_fill(color = "#9edee0"),
        cell_text(weight = "bold"),
        cell_text(color = "black"),
        cell_text(v_align = "middle") 
      ),
      locations = list(
        cells_stubhead(),
        cells_column_spanners(),
        cells_column_labels() 
      )
    ) %>% 
    tab_style(
      style = list(
        cell_fill(color = "#ebfcf9"),
        cell_text(v_align = "middle") 
      ),
      locations = list(
        cells_stub()
      ) 
    ) %>% 
    tab_style(
      style = list(
        cell_text(align = "center") 
      ),
      locations = list(
        cells_column_labels(columns = everything())
      )
    ) %>% 
    tab_style(
      style = list(
        cell_text(align = "center") 
      ),
      locations = list(
        cells_body(columns = everything())
      ) 
    ) %>%
    fmt_markdown(columns = everything()) %>%
    tab_options(table.width = pct(100)) %>%
    cols_width(1 ~ px(200))
} 
```


\tableofcontents

\newpage
# Lab results distribution

```{r define point function}
#scatter plot function
plot_point <- function(data, var, var_label) {
  if(max(data$time) >= 60) {
    data %>%
      ggplot(aes(x = time, y = var)) + 
      geom_point(alpha = 0.3,  size = 0.1, aes(color = "point")) +
      geom_smooth(method="loess",  se=TRUE, size = 0.5, span = 0.75, aes(color="line")) +
      scale_x_continuous(
        breaks=seq(4,66,1),
        labels = c("4", "5", "6", "7", "8", "9", "10",
                   "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", 
                   "21", "22", "23", "24", "25", "26", "27", "28", "29", "30",
                   "31", "32", "33", "34", "35", "35", "37", "38", "39", "40",
                   "41", "42", "43", "44", "45", "46", "47", "48", "49", "50", 
                   "51", "52", "53", "54", "55", "56", "57", "58", "59", "IPC",
                   "PNC0", "PNC1", "PNC4", "PNC6", "PNC26", "PNC52")) +
      xlab("Gestational Age (weeks) and PNC visits") +
      facet_grid(rows = vars(SITE), scales = "free_y") +
      theme_bw() +
      theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust= 0.5),
            axis.text = element_text(size = 7), 
            legend.position="bottom",
            panel.grid.minor = element_blank(),
            strip.background=element_rect(fill="white"), 
            strip.text = element_text(size = 7), 
      ) +
      scale_color_manual(
        name="",
        labels=c(var_label,"Fitted smooth line with 95% confidence band"),
        breaks = c("point", "line"),
        values=c("point" = "#c02b18", "line" = "#00a693"),
        guide=guide_legend(override.aes = list(
          linetype=c("blank", "solid"),
          shape=c(16,NA),
          alpha=0.8, fill = c(NA,"lightgrey")))) +
      scale_x_break(
        breaks = c(43,60),
        space = 0.1, 
        scales = 0.25)
  }
  else if(max(data$time) < 60) {
    data %>%
      ggplot(aes(x = time, y = var)) + 
      geom_point(alpha = 0.3,  size = 0.1, aes(color = "point")) +
      geom_smooth(method="loess",  se=TRUE, size = 0.5, span = 0.75, aes(color="line")) +
      scale_x_continuous(breaks=seq(4,66,1)) +
      xlab("Gestational Age (weeks)") +
      facet_grid(rows = vars(SITE), scales = "free_y") +
      theme_bw() +
      theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust= 0.5),
            axis.text = element_text(size = 7), 
            legend.position="bottom",
            panel.grid.minor = element_blank(),
            strip.background=element_rect(fill="white"), 
            strip.text = element_text(size = 7), 
      ) +
      scale_color_manual(
        name="",
        labels=c(var_label,"Fitted smooth line with 95% confidence band"),
        breaks = c("point", "line"),
        values=c("point" = "#c02b18", "line" = "#00a693"),
        guide=guide_legend(override.aes = list(
          linetype=c("blank", "solid"),
          shape=c(16,NA),
          alpha=0.8, fill = c(NA,"lightgrey")))) 
  }
}

```

```{r define line function}
#smooth line function
plot_line <- function(data, var) {
  if(max(data$time) >= 60) {
    data %>%
      ggplot(aes(x = time, y = var, group=SITE, color=SITE)) + 
      geom_smooth(method="loess",  se=TRUE, size = 0.6, span = 0.75) +
      scale_x_continuous(
        breaks=seq(4,66,1),
        labels = c("4", "5", "6", "7", "8", "9", "10",
                   "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", 
                   "21", "22", "23", "24", "25", "26", "27", "28", "29", "30",
                   "31", "32", "33", "34", "35", "35", "37", "38", "39", "40",
                   "41", "42", "43", "44", "45", "46", "47", "48", "49", "50", 
                   "51", "52", "53", "54", "55", "56", "57", "58", "59", "IPC",
                   "PNC0", "PNC1", "PNC4", "PNC6", "PNC26", "PNC52")) +
      xlab("Gestational Age (weeks) and PNC visits") +
      theme_bw() +
      theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=0.5),
            axis.text = element_text(size = 7), 
            legend.position="bottom",
            panel.grid.minor = element_blank(),
            strip.text = element_text(size = 7), 
            strip.background=element_rect(fill="white")) +
      scale_color_manual(values = c(
        "Ghana" = "#e4d001", "India-CMC" = "#0077b6", "India-SAS" = "#663399",
        "Kenya" = "#b31b1b", "Pakistan" = "#03ac13", "Zambia" = "#f18200")) +
      scale_x_break(
        breaks = c(43,60),
        space = 0.1, 
        scales = 0.25)
  }
  else if(max(data$time) < 60) {
    data %>%
      ggplot(aes(x = time, y = var, group=SITE, color=SITE)) + 
      geom_smooth(method="loess",  se=TRUE, size = 0.6, span = 0.75) +
      scale_x_continuous(
        breaks=seq(4,43,1)) +
      xlab("Gestational Age (weeks)") +
      theme_bw() +
      theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=0.5),
            axis.text = element_text(size = 8), 
            legend.position="bottom",
            panel.grid.minor = element_blank(),
            strip.background=element_rect(fill="white")) +
      scale_color_manual(values = c(
        "Ghana" = "#e4d001", "India-CMC" = "#0077b6", "India-SAS" = "#663399",
        "Kenya" = "#b31b1b", "Pakistan" = "#03ac13", "Zambia" = "#f18200"))
  }}

```

```{r define bar chart function for level vars (trimester)}
#bar function
plot_bar <- function(data, var, var_label) {
  df_text <- data %>% 
    mutate(var = as.character(var)) %>% 
    group_by(SITE, trimester) %>% 
    summarize(g1n = sum(var %in% c("High", "Positive")),
              g2n = sum(var %in% c("Normal", "Inconclusive")),
              g3n = sum(var %in% c("Low", "Negative")), 
              totn = sum(!is.na(var)),
              totn_d = sum(!is.na(var))) %>% 
    rowwise() %>%
    mutate(
      g2ncum = totn - g1n,
    ) %>%
    ungroup() %>% 
    pivot_longer(-c(SITE, trimester, totn_d, g2ncum), 
                 values_to = "gn",
                 names_to = "gname") %>%
    mutate(
      ypos = case_when(
        gname == "totn" ~ 1.02,
        gname == "g1n" ~ 0.98,
        gname == "g2n" ~ g2ncum/totn_d - 0.02,
        gname == "g3n" ~ gn/totn_d - 0.02
      ),
      label = case_when(
        gname == "totn" ~ totn_d,
        gn == 0 ~ NA,
        gname != "totn" ~ gn,
      )
    )
  
  #plot bar
  data %>%
    ggplot(aes(x = trimester)) +
    geom_bar(aes(fill = var), alpha = 0.9, position = position_fill(reverse = TRUE), color = "white",
             size = 0.1) +
    scale_fill_manual(
      values = c("Low" = "#f18200", "Normal" = "#70B23F", "High" = "#CB2314", 
                 "Positive" = "#E54E21", "Inconclusive" = "#FDD262", "Negative" = "#00A08A"), 
      drop = FALSE) + 
    scale_y_continuous(labels = percent) +
    xlab("Trimester") +
    ylab("Percentage") +
    facet_grid(cols = vars(SITE),  margins = FALSE) + 
    theme_bw() +
    theme(
      strip.background=element_rect(fill="white"),
      axis.text.x = element_text(angle = 0, vjust = 1, hjust=0.5, size = 8),
      legend.position="right",
      legend.title = element_text(color = "black", size = 9), 
      panel.grid.minor = element_blank(),
      axis.text.y = element_text(size = 8),
      legend.text = element_text(size = 8),
      axis.title = element_text(size = 10)
    ) +
    guides(fill=guide_legend(title = var_label, reverse = TRUE)) +
    geom_text(data = df_text, aes(x = trimester, y = ypos, label = label), color = "grey10", size = 2.5)
}
```

```{r define histo function}
#histogram function
plot_histo <- function(data, var, var_label) {
  if(max(data$time) >= 60) {
    data %>%
      ggplot(aes(x = time, fill = var)) +
      geom_histogram(color = "white", linewidth = 0.01,
                     alpha= 0.8, position = position_fill(reverse = TRUE), binwidth = 1) + 
      scale_fill_manual(values= c("Negative" = "#00A08A","None(negative)" = "#00A08A",
                                  "Trace" = "#BDC881",
                                  "1+(0.3 g/L)" = "#FAD77B", "1+" = "#FAD77B", "Inconclusive" = "#FAD77B",
                                  "2+(1 g/L)" = "orange", "2+" = "orange",
                                  "3+(3 g/L)" = "#EF5703",
                                  "4+(>10 g/L)" = "#B40F20", "3+" = "#B40F20", "Present(postive)" = "#B40F20", "Positive" = "#B40F20"),
                        guide=guide_legend(override.aes = list(alpha=0.8))) +
      scale_x_continuous(
        breaks=seq(4,66,1), 
        labels = c("4", "5", "6", "7", "8", "9", "10",
                   "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", 
                   "21", "22", "23", "24", "25", "26", "27", "28", "29", "30",
                   "31", "32", "33", "34", "35", "35", "37", "38", "39", "40",
                   "41", "42", "43", "44", "45", "46", "47", "48", "49", "50", 
                   "51", "52", "53", "54", "55", "56", "57", "58", "59", "IPC",
                   "PNC0", "PNC1", "PNC4", "PNC6", "PNC26", "PNC52")) +
      scale_y_continuous(labels = percent) +
      xlab("Gestational Age (weeks) and PNC visits") +
      ylab("Percentage") +
      facet_grid(rows = vars(SITE), scales = "free_y") + 
      theme_bw() +
      theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust= 0.5),
            axis.text = element_text(size = 8), 
            legend.position="right",
            panel.grid.minor = element_blank(),
            strip.background=element_rect(fill="white"), 
            strip.text = element_text(size = 8), 
            legend.text = element_text(size = 7), 
            legend.title = element_text(size = 8)
      ) +
      guides(fill=guide_legend(title=var_label,reverse=TRUE, override.aes = list(size = 3))) +
      scale_x_break(
        breaks = c(43,60),
        space = 0.1, 
        scales = 0.25) 
  }
  else if(max(data$time) < 60) {
    data %>%
      ggplot(aes(x = time, fill = var)) +
      geom_histogram(color = "white", linewidth = 0.01,
                     alpha= 0.8, position = position_fill(reverse = TRUE), binwidth = 1) + 
      scale_fill_manual(values= c("Negative" = "#00A08A","None(negative)" = "#00A08A",
                                  "Trace" = "#BDC881",
                                  "1+(0.3 g/L)" = "#FAD77B", "1+" = "#FAD77B", "Inconclusive" = "#FAD77B",
                                  "2+(1 g/L)" = "orange", "2+" = "orange",
                                  "3+(3 g/L)" = "#EF5703",
                                  "4+(>10 g/L)" = "#B40F20", "3+" = "#B40F20", "Present(postive)" = "#B40F20", "Positive" = "#B40F20"),
                        guide=guide_legend(override.aes = list(alpha=0.8))) +
      scale_x_continuous(seq(4,44,1)) +
      xlab("Gestational Age (weeks)") +
      ylab("Percentage") +
      facet_grid(rows = vars(SITE), scales = "free_y") +
      theme_bw() +
      theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust= 0.5),
            axis.text = element_text(size = 8), 
            legend.position="right",
            panel.grid.minor = element_blank(),
            strip.background=element_rect(fill="white"), 
            strip.text = element_text(size = 8),
            legend.text = element_text(size = 7), 
            legend.title = element_text(size = 8)
      ) +
      guides(fill=guide_legend(title=var_label,reverse=TRUE, override.aes = list(size = 3)))
  }}
```

```{r define prop line function}
#prop line function
plot_prop_line <- function(data, var) {
  data %>%
    ggplot(aes(x=floor(time), y = prop, group = SITE, color = SITE, fill = SITE)) +
    geom_line() +
    scale_x_continuous(
      breaks=seq(4,66,1),
      labels = c("4", "5", "6", "7", "8", "9", "10",
                 "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", 
                 "21", "22", "23", "24", "25", "26", "27", "28", "29", "30",
                 "31", "32", "33", "34", "35", "35", "37", "38", "39", "40",
                 "41", "42", "43", "44", "45", "46", "47", "48", "49", "50", 
                 "51", "52", "53", "54", "55", "56", "57", "58", "59", "IPC",
                 "PNC0", "PNC1", "PNC4", "PNC6", "PNC26", "PNC52")) +
    scale_y_continuous(labels = percent, breaks = seq(0,1,0.05)) +
    xlab("Gestational Age (weeks) and PNC visits") +
    theme_bw() +
    theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust= 0.5),
          axis.text = element_text(size = 8), 
          legend.position="bottom",
          panel.grid.minor = element_blank(),
          strip.background=element_rect(fill="white"), 
          strip.text = element_text(size = 8), 
    ) +
    scale_color_brewer(palette="Set1") +
    scale_x_break(
      breaks = c(43,60),
      space = 0.1, 
      scales = 0.25)
}

```

```{r define the bar chart function for single visit vars}
plot_cat_bar <- function(data, var, var_label) {
  if (n_distinct(var) > 2) {
    df_text <- data %>% 
      mutate(var = as.character(var)) %>% 
      group_by(SITE) %>% 
      summarize(g1n = sum(var == "A"),
                g2n = sum(var == "B"),
                g3n = sum(var == "AB"), 
                g4n = sum(var == "O"),
                totn = sum(!is.na(var)),
                totn_d = sum(!is.na(var))) %>% 
      rowwise() %>%
      mutate(
        g2ncum = totn - g1n,
        g3ncum = totn - g1n - g2n
      ) %>%
      ungroup() %>% 
      pivot_longer(-c(SITE, totn_d, g2ncum, g3ncum),
                   values_to = "gn",
                   names_to = "gname") %>%
      mutate(
        ypos = case_when(
          gname == "totn" ~ 1.02,
          gname == "g1n" ~ 0.98,
          gname == "g2n" ~ g2ncum/totn_d - 0.02,
          gname == "g3n" ~ g3ncum/totn_d - 0.02,
          gname == "g4n" ~ gn/totn_d - 0.02
        ),
        label = case_when(
          gname == "totn" ~ paste0("N = ", totn_d),
          gn == 0 ~ NA,
          gname != "totn" ~ paste0("n = ", gn)
        )
      )
  }
  else if (n_distinct(var) <= 2) {
    df_text <- data %>% 
      mutate(var = as.character(var)) %>% 
      group_by(SITE) %>% 
      summarize(g1n = sum(var %in% c("Positive", "Sickle cell disease present", "Hemoglobinopathy or Thalassemia")),
                g2n = sum(var %in% c("Negative", "Normal, disease absent")),
                totn = sum(!is.na(var)),
                totn_d = sum(!is.na(var))) %>% 
      ungroup() %>% 
      pivot_longer(-c(SITE, totn_d),
                   values_to = "gn",
                   names_to = "gname") %>%
      mutate(
        ypos = case_when(
          gname == "totn" ~ 1.02,
          gname == "g1n" ~ 0.98,
          gname == "g2n" ~ gn/totn_d - 0.02
        ),
        label = case_when(
          gname == "totn" ~ paste0("N = ", totn_d),
          gn == 0 ~ NA,
          gname != "totn" ~ paste0("n = ", gn)
        )
      )
  }
  
  data %>%
    ggplot(aes(x = SITE)) +
    geom_bar(aes(fill = var), alpha = 0.9, position = position_fill(reverse = TRUE), color = "white",
             linewidth = 0, width = 0.6) +
    scale_y_continuous(labels = percent) +
    xlab("") + 
    ylab("Percentage") +
    theme_bw() +
    theme(
      strip.background=element_rect(fill="white"),
      axis.text.x = element_text(angle = 0, vjust = 1, hjust=0.5, size = 8),
      legend.position="right",
      legend.title = element_text(color = "black", size = 9), 
      panel.grid.minor = element_blank(),
      axis.text.y = element_text(size = 8),
      legend.text = element_text(size = 8),
      axis.title = element_text(size = 10)
    ) +
    scale_fill_manual(values= wes_palette("AsteroidCity1"),
                      guide=guide_legend(override.aes = list(alpha=0.8)),
                      name= str_replace_all(deparse(substitute(var)), c(".*\\$" = "", "`" = ""))) +
    geom_text(data = df_text, aes(x = SITE, y = ypos, label = label), color = "grey10", size = 3) +
    guides(fill = guide_legend(title = var_label, reverse = TRUE)) 
}

```

## Point of care test results (MNH06)

### Point of care hemoglobin test results 

#### figure 3.1.1.1. POC HB distribution by gestational age (GA) and PNC visits by site
```{r}
#scatter plot
df_poc_hb <- df_lab_06_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, HB_POC_LBORRES, trimester, time) %>% 
  filter(!is.na(HB_POC_LBORRES) & !is.na(time)) 

plot_point(df_poc_hb, df_poc_hb$HB_POC_LBORRES, "POC HB") +
  ylab("Point-of-care hemoglobin: g/dL") +
  scale_y_continuous(limits = c(0,NA))

```
* Point of care hemoglobin is not performed at ANC visit for India CMC

\newpage
#### figure 3.1.1.2. POC HB site comparison by gestational age (GA) and PNC visits
```{r}
plot_line(df_poc_hb, df_poc_hb$HB_POC_LBORRES) +
  ylab("POC HB (g/dL)") +
  scale_y_continuous(limits = c(0,NA))
```

\newpage
### Point of care malaria test results 

#### figure 3.1.2.1. Percentage of participants with positive POC malaria at enrollment each site

```{r}
df_poc_malaria <- df_lab_06_l %>%
  filter(TYPE_VISIT == 1) %>%
  select(MOMID, PREGID, SITE, MALARIA_POC_LBORRES) %>%
  filter(!is.na(MALARIA_POC_LBORRES)) 

plot_cat_bar(df_poc_malaria, df_poc_malaria$MALARIA_POC_LBORRES, "POC Malaria") 

```

\newpage
### Point of care HIV test results

#### figure 3.1.3.1. Percentage of participants with positive POC HIV at enrollment each site

```{r}
df_poc_hiv <- df_lab_06_l %>%
  filter(TYPE_VISIT == 1) %>%
  select(MOMID, PREGID, SITE, HIV_POC_LBORRES) %>%
  filter(!is.na(HIV_POC_LBORRES)) 

plot_cat_bar(df_poc_hiv, df_poc_hiv$HIV_POC_LBORRES, "POC HIV") 

```

\newpage
### Point of care syphilis test results

#### figure 3.1.4.1. Percentage of participants with positive POC syphilis at enrollment each site 

```{r}
df_poc_syphilis <- df_lab_06_l %>%
  filter(TYPE_VISIT == 1) %>%
  select(MOMID, PREGID, SITE, SYPH_POC_LBORRES) %>%
  filter(!is.na(SYPH_POC_LBORRES)) 

plot_cat_bar(df_poc_syphilis, df_poc_syphilis$SYPH_POC_LBORRES, "POC Syphilis") 

```

\newpage
### Point of care HBV test results 

#### figure 3.1.5.1. Percentage of participants with positive POC HBV at enrollment each site 

```{r}
df_poc_hbv <- df_lab_06_l %>%
  filter(TYPE_VISIT == 1) %>%
  select(MOMID, PREGID, SITE, HBV_POC_LBORRES) %>%
  filter(!is.na(HBV_POC_LBORRES)) 

plot_cat_bar(df_poc_hbv, df_poc_hbv$HBV_POC_LBORRES, "POC HBV") 

```

\newpage
### Point of care HCV test results

#### figure 3.1.6.1. Percentage of participants with positive POC HCV at enrollment each site 

```{r}
df_poc_hcv <- df_lab_06_l %>%
  filter(TYPE_VISIT == 1) %>%
  select(MOMID, PREGID, SITE, HCV_POC_LBORRES) %>%
  filter(!is.na(HCV_POC_LBORRES)) 

plot_cat_bar(df_poc_hcv, df_poc_hcv$HCV_POC_LBORRES, "POC HCV") 

```

\newpage
### Point of care blood glucose test results

#### figure 3.1.7.1 POC blood glucose distribution at ANC28 visit by site

```{r}
df_poc_bloglu <- df_lab_06_l %>%
  filter(TYPE_VISIT == 3) %>%
  select(MOMID, PREGID, SITE, BGLUC_POC_MMOLL_LBORRES) %>%
  filter(!is.na(BGLUC_POC_MMOLL_LBORRES)) 

df_poc_bloglu %>%
  ggplot(aes(x = BGLUC_POC_MMOLL_LBORRES)) +
  geom_histogram(alpha = 0.8, binwidth = 0.1, fill = "#0A9F9D") +
  xlab ("Point of Care Blood Glucose (mmol/L)") +
  ylab("Frequency") +
  scale_x_continuous(
    breaks = seq(floor(min(df_poc_bloglu$BGLUC_POC_MMOLL_LBORRES)), max(df_poc_bloglu$BGLUC_POC_MMOLL_LBORRES),
                 max(0.5, floor((max(df_poc_bloglu$BGLUC_POC_MMOLL_LBORRES)-min(df_poc_bloglu$BGLUC_POC_MMOLL_LBORRES))/50)))) +
  facet_grid(SITE ~ ., scales = "free_y") + 
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust= 0.5),
        axis.text = element_text(size = 8),
        legend.position = "none",
        panel.grid.minor = element_blank(),
        strip.background=element_rect(fill="white"),
        strip.text = element_text(size = 8),
  )

```

\newpage
## Blood typing results (MNH08)

### Blood Group 

#### figure 3.2.1.1. Bood group distribution at enrollment by site
```{r}
#scatter plot
df_blogro <- df_lab_08_l %>% 
  filter(TYPE_VISIT == 1) %>% 
  select(MOMID, PREGID, SITE, BLD_GRP_LBORRES) %>% 
  filter(!is.na(BLD_GRP_LBORRES)) 

plot_cat_bar(df_blogro, df_blogro$BLD_GRP_LBORRES, "Blood Group") 


```

\newpage
### RH Factor 

#### figure 3.2.2.1. RH Factor distribution at enrollment each site 
```{r}
df_rh <- df_lab_08_l %>%  
  filter(TYPE_VISIT == 1) %>% 
  select(MOMID, PREGID, SITE, RH_FACTOR_LBORRES) %>% 
  filter(!is.na(RH_FACTOR_LBORRES))

plot_cat_bar(df_rh, df_rh$RH_FACTOR_LBORRES, "RH Factor") 

```

\newpage
## CBC test results (MNH08)

### CBC hemoglobin test results

#### figure 3.3.1.1. CBC HB distribution by gestational age (GA) and PNC visits by site
```{r}
#scatter plot
df_hb <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, CBC_HB_LBORRES, trimester, time) %>%  
  filter(!is.na(CBC_HB_LBORRES) & !is.na(time)) 

plot_point(df_hb, df_hb$CBC_HB_LBORRES, "CBC HB") +
  ylab("Hemoglobin (g/dL)") 

```
\newpage
#### figure 3.3.1.2. CBC HB site comparison by gestational age (GA) and PNC visits
```{r}
plot_line(df_hb, df_hb$CBC_HB_LBORRES) +
  ylab("Hemoglobin (g/dL)") 

```

\newpage
### Hematocrit (HCT) test results

#### figure 3.3.2.1. Hematocrit (HCT) distribution by gestational age (GA) and PNC visits by site
```{r}
#scatter plot
df_hct <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, CBC_HCT_LBORRES, hct_level, trimester, time) %>% 
  filter(!is.na(CBC_HCT_LBORRES) & !is.na(time)) 

plot_point(df_hct, df_hct$CBC_HCT_LBORRES, "HCT") +
  ylab("Hematocrit (%)") 

```
\newpage
#### figure 3.3.2.2. Hematocrit (HCT) site comparison by gestational age (GA) and PNC visits
```{r}
plot_line(df_hct, df_hct$CBC_HCT_LBORRES) +
  ylab("Hematocrit (%)") 
```
\newpage
#### figure 3.3.2.3. Hematocrit (HCT) level within trimester by site
```{r}
df_hct_level <- df_hct %>%
  filter(!is.na(trimester)) 

plot_bar(df_hct_level, df_hct_level$hct_level, "HCT level") 

```

* HCT(%) level are defined as:
```{r echo=FALSE, results='asis'}
tb_hct_level <- data.frame(
  "Level" = c("High", "Normal", "Low"), 
  "Trimester 1" = c("> 41", "31 - 41", "< 31"),
  "Trimester 2" = c("> 39", "30 - 39", "< 30"),
  "Trimester 3" = c("> 40", "28 - 40", "< 28")
)
knitr::kable(tb_hct_level)
```


\newpage
### White Blood Cells (WBC) [total leukocyte count] 

#### figure 3.3.3.1. White Blood Cells (WBC) distribution by gestational age (GA) and PNC visits by site
```{r}
#scatter plot
df_wbc <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, CBC_WBC_LBORRES, wbc_level, trimester, time) %>% 
  filter(!is.na(CBC_WBC_LBORRES) & !is.na(time))  

plot_point(df_wbc, df_wbc$CBC_WBC_LBORRES, "WBC") +
  ylab(expression(paste("White Blood Cells (x",10^{3},"/m", m^{3},")")))

```

\newpage
#### figure 3.3.3.2. White Blood Cells (WBC) site comparison by gestational age (GA) and PNC visits
```{r}
plot_line(df_wbc, df_wbc$CBC_WBC_LBORRES) +
  ylab(expression(paste("White Blood Cells (x",10^{3},"/m",m^{3},")")))
```

\newpage
#### figure 3.3.3.3. White Blood Cells (WBC) level within trimester by site
```{r}
df_wbc_level <- df_wbc %>%
  filter(!is.na(trimester))

plot_bar(df_wbc_level, df_wbc_level$wbc_level, "WBC level") 
```

* WBC(x10³/mm³) level are defined as:

```{r echo=FALSE, results='asis'}
tb_wbc_level <- data.frame(
  "Level" = c("High", "Normal", "Low"), 
  "Trimester 1" = c("> 13.6", "5.7 - 13.6", "< 5.7"),
  "Trimester 2" = c("> 14.8", "5.6 - 14.8", "< 5.6"),
  "Trimester 3" = c("> 16.9", "5.6 - 16.9", "< 5.6")
)
knitr::kable(tb_wbc_level)
```


\newpage
### Neutrophils (%) results

#### figure 3.3.4.1. Neutrophils (%) distribution by gestational age (GA) and PNC visits by site
```{r}
#scatter plot
df_neutrophils <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, CBC_NEU_PCT_LBORRES, neutrophils_level, trimester, time) %>% 
  filter(!is.na(CBC_NEU_PCT_LBORRES) & !is.na(time)) 

plot_point(df_neutrophils, df_neutrophils$CBC_NEU_PCT_LBORRES, "Neutrophils") +
  ylab("Neutrophils (%)") 

```

\newpage
#### figure 3.3.4.2. Neutrophils (%) site comparison by gestational age (GA) and PNC visits
```{r}
plot_line(df_neutrophils, df_neutrophils$CBC_NEU_PCT_LBORRES) +
  ylab("Neutrophils (%)") 
```

\newpage
### Neutrophils (full cell count) test results

#### figure 3.3.5.1. Neutrophils (full cell count) distribution by gestational age (GA) and PNC visits by site
```{r}
#scatter plot
df_neutrophils_count <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, CBC_NEU_FCC_LBORRES, neutrophils_level, trimester, time) %>% 
  filter(!is.na(CBC_NEU_FCC_LBORRES) & !is.na(time)) 

plot_point(df_neutrophils_count, df_neutrophils_count$CBC_NEU_FCC_LBORRES, "Neutrophils (full cell count)") +
  ylab(expression(paste("Neutrophils (full cell count) (x",10^{3},"/m",m^{3},")")))

```

\newpage
#### figure 3.3.5.2. Neutrophils (full cell count) site comparison by gestational age (GA) and PNC visits
```{r}
plot_line(df_neutrophils_count, df_neutrophils_count$CBC_NEU_FCC_LBORRES) +
  ylab(expression(paste("Neutrophils (full cell count) (x",10^{3},"/m",m^{3},")")))

```

\newpage
#### figure 3.3.5.3. Neutrophils (full cell count) level within trimester by site
```{r}
df_neutrophils_level <- df_neutrophils_count %>%
  filter(!is.na(trimester))

plot_bar(df_neutrophils_level, df_neutrophils_level$neutrophils_level, "Neutrophils (full cell count) level") 

```

* Neutrophils (full cell count)(x10³/mm³) level are defined as:

```{r echo=FALSE, results='asis'}
tb_neutrophils_level <- data.frame(
  "Level" = c("High", "Normal", "Low"), 
  "Trimester 1" = c("> 10.1", "3.6 - 10.1", "< 3.6"),
  "Trimester 2" = c("> 12.3", "3.8 - 12.3", "< 3.8"),
  "Trimester 3" = c("> 13.1", "3.9 - 13.1", "< 3.9")
)
knitr::kable(tb_neutrophils_level)
```

\newpage
### Lymphocyte (%) test results

#### figure 3.3.6.1. Lymphocyte (%) distribution by gestational age (GA) and PNC visits by site
```{r}
#scatter plot
df_lymphocyte <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, CBC_LYMPH_PCT_LBORRES, trimester, time) %>% 
  filter(!is.na(CBC_LYMPH_PCT_LBORRES) & !is.na(time)) 

plot_point(df_lymphocyte, df_lymphocyte$CBC_LYMPH_PCT_LBORRES, "Lymphocyte (%)") +
  ylab("Lymphocyte (%)") 

```

\newpage
#### figure 3.3.6.2. Lymphocyte (%) site comparison by gestational age (GA) and PNC visits
```{r}
plot_line(df_lymphocyte, df_lymphocyte$CBC_LYMPH_PCT_LBORRES) +
  ylab("Lymphocyte (%)") 
```

\newpage
### Lymphocyte (full cell count) 

#### figure 3.3.7.1. Lymphocyte (full cell count) distribution by gestational age (GA) and PNC visits by site
```{r}
#scatter plot
df_lymphocyte_count <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, CBC_LYMPH_FCC_LBORRES, lymphocyte_level, trimester, time) %>% 
  filter(!is.na(CBC_LYMPH_FCC_LBORRES) & !is.na(time))  

plot_point(df_lymphocyte_count, df_lymphocyte_count$CBC_LYMPH_FCC_LBORRES, "Lymphocyte (full cell count)") +
  ylab(expression(paste("Lymphocyte (full cell count) (x",10^{3},"/m",m^{3},")")))

```

\newpage
#### figure 3.3.7.2. Lymphocyte (full cell count) site comparison by gestational age (GA) and PNC visits
```{r}
plot_line(df_lymphocyte_count, df_lymphocyte_count$CBC_LYMPH_FCC_LBORRES) +
  ylab(expression(paste("Lymphocyte (full cell count) (x",10^{3},"/m",m^{3},")")))
```

\newpage
#### figure 3.3.7.3. Lymphocyte (full cell count) level within trimester by site
```{r}
df_lymphocyte_level <- df_lymphocyte_count %>%
  filter(!is.na(trimester))

plot_bar(df_lymphocyte_level, df_lymphocyte_level$lymphocyte_level, "Lymphocyte (full cell count) level") 

```

* Lymphocyte (full cell count) (x10³/mm³) level are defined as:
```{r echo=FALSE, results='asis'}
tb_lymphocyte_level <- data.frame(
  "Level" = c("High", "Normal", "Low"), 
  "Trimester 1" = c("> 3.6", "1.1 - 3.6", "< 1.1"),
  "Trimester 2" = c("> 3.9", "0.9 - 3.9", "< 0.9"),
  "Trimester 3" = c("> 3.6", "1 - 3.6", "< 1")
)
knitr::kable(tb_lymphocyte_level)
```

\newpage
### Erythrocyte count 

#### figure 3.3.8.1. Erythrocyte count distribution by gestational age (GA) and PNC visits by site
```{r}
#scatter plot
df_erythrocyte <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, CBC_ERYTH_MM_LBORRES, trimester, time) %>% 
  filter(!is.na(CBC_ERYTH_MM_LBORRES) & !is.na(time)) 

plot_point(df_erythrocyte, df_erythrocyte$CBC_ERYTH_MM_LBORRES, "Erythrocyte count") +
  ylab(expression(paste("Erythrocyte count (x",10^{6},"/m",m^{3},")"))) 

```

\newpage
#### figure 3.3.8.2. Erythrocyte count site comparison by gestational age (GA) and PNC visits
```{r}
plot_line(df_erythrocyte, df_erythrocyte$CBC_ERYTH_MM_LBORRES) +
  ylab(expression(paste("Erythrocyte count (x",10^{6},"/m",m^{3},")"))) 
```

\newpage
### Mean cell volume (MCV) test results 

#### figure 3.3.9.1. Mean cell volume (MCV) distribution by gestational age (GA) and PNC visits by site
```{r}
#scatter plot
df_mcv <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, CBC_MCV_LBORRES, mcv_level, trimester, time) %>% 
  filter(!is.na(CBC_MCV_LBORRES) & !is.na(time)) 

plot_point(df_mcv, df_mcv$CBC_MCV_LBORRES, "MCV") +
  ylab(expression(paste("Mean cell volume (µ",m^{3},")"))) 


```

\newpage
#### figure 3.3.9.2. Mean cell volume (MCV) site comparison by gestational age (GA) and PNC visits 
```{r}
plot_line(df_mcv, df_mcv$CBC_MCV_LBORRES) +
  ylab(expression(paste("Mean cell volume (µ",m^{3},")"))) 
```

\newpage
#### figure 3.3.9.3. Mean cell volume (MCV) level within trimester by site 
```{r}
df_mcv_level2 <- df_mcv %>%
  mutate(
    mcv_level2 = case_when(
    mcv_level == "High" ~ "Macrocytic", 
    mcv_level == "Normal" ~ "Normocytic", 
    mcv_level == "Low" ~ "Microcytic"
  ), 
  mcv_level2 = factor(mcv_level2, levels = c("Microcytic", "Normocytic", "Macrocytic"))) 

plot_bar(df_mcv_level2, df_mcv_level2$mcv_level2, "MCV level") 

```

* MCV (µm³) level are defined as:
```{r echo=FALSE, results='asis'}
tb_mcv_level <- data.frame(
  "Level" = c("High", "Normal", "Low"), 
  "Trimester 1" = c("> 97.9", "85 - 97.9", "< 85"),
  "Trimester 2" = c("> 99.4", "85.8 - 99.4", "< 85.8"),
  "Trimester 3" = c("> 100.4", "82.4 - 100.4", "< 82.4")
)
knitr::kable(tb_mcv_level)
```

\newpage
### Mean cell hemoglobin (MCH)

#### figure 3.3.10.1. Mean cell hemoglobin (MCH) distribution by gestational age (GA) and PNC visits by site
```{r}
#scatter plot
df_mch <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, CBC_MCH_LBORRES, mch_level, trimester, time) %>% 
  filter(!is.na(CBC_MCH_LBORRES) & !is.na(time))  

plot_point(df_mch, df_mch$CBC_MCH_LBORRES, "MCH") +
  ylab(expression(paste("Mean cell hemoglobin (pg/cell)")))

```

\newpage
#### figure 3.3.10.2. Mean cell hemoglobin (MCH) site comparison by gestational age (GA) and PNC visits 
```{r}
plot_line(df_mch, df_mch$CBC_MCH_LBORRES) +
  ylab(expression(paste("Mean cell hemoglobin (pg/cell)"))) 

```

\newpage
#### figure 3.3.10.3. Mean cell hemoglobin (MCH) level within trimester by site 
```{r}
df_mch_level <- df_mch %>%
  filter(!is.na(trimester))

plot_bar(df_mch_level, df_mch_level$mch_level, "MCH level") 

```

* MCH (pg/cell) level are defined as:
```{r echo=FALSE, results='asis'}
tb_mch_level <- data.frame(
  "Level" = c("High", "Normal", "Low"), 
  "Trimester 1" = c("> 32", "30 - 32", "< 30"),
  "Trimester 2" = c("> 33", "30 - 33", "< 30"),
  "Trimester 3" = c("> 32", "29 - 32", "< 29")
)
knitr::kable(tb_mch_level)
```

\newpage
### Mean corpuscular hemoglobin concentration (MCHC) 

#### figure 3.3.11.1. Mean corpuscular hemoglobin concentration (MCHC) distribution by gestational age (GA) and PNC visits by site
```{r}
#scatter plot
df_mchc <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, CBC_MCHC_GDL_LBORRES, mchc_level, trimester, time) %>% 
  filter(!is.na(CBC_MCHC_GDL_LBORRES) & !is.na(time)) 

plot_point(df_mchc, df_mchc$CBC_MCHC_GDL_LBORRES, "MCHC") +
  ylab(expression(paste("Mean corpuscular hemoglobin concentration (g/dL)"))) 

```

\newpage
#### figure 3.3.11.2. Mean corpuscular hemoglobin concentration (MCHC) site comparison by gestational age (GA) and PNC visits 
```{r}
plot_line(df_mchc, df_mchc$CBC_MCHC_GDL_LBORRES) +
  ylab(expression(paste("Mean corpuscular hemoglobin concentration (g/dL)"))) 

```

\newpage
#### figure 3.3.11.3. Mean corpuscular hemoglobin concentration (MCHC) level within trimester by site 
```{r}
df_mchc_level <- df_mchc %>%
  filter(!is.na(trimester))

plot_bar(df_mchc_level, df_mchc_level$mchc_level, "MCHC level") 

```

* MCHC (g/dL) level are defined as:
```{r echo=FALSE, results='asis'}
tb_mchc_level <- data.frame(
  "Level" = c("High", "Normal", "Low"), 
  "Trimester 1" = c("> 35.3", "32.5 - 35.3", "< 32.5"),
  "Trimester 2" = c("> 35.2", "32.4 - 35.2", "< 32.4"),
  "Trimester 3" = c("> 35.5", "31.9 - 35.5", "< 31.9")
)
knitr::kable(tb_mchc_level)
```


\newpage
### Platelets count

#### figure 3.3.12.1. Platelets count distribution by gestational age (GA) and PNC visits by site
```{r}
#scatter plot
df_platelets <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, CBC_PLATE_LBORRES, platelets_level, trimester, time) %>% 
  filter(!is.na(CBC_PLATE_LBORRES) & !is.na(time)) 

plot_point(df_platelets, df_platelets$CBC_PLATE_LBORRES, "Platelets count") +
  ylab(expression(paste("Platelets count (x",10^{3},"/m",m^{3},")"))) 

```

\newpage
#### figure 3.3.12.2. Platelets count site comparison by gestational age (GA) and PNC visits 
```{r}
plot_line(df_platelets, df_platelets$CBC_PLATE_LBORRES) +
  ylab(expression(paste("Platelets count (x",10^{3},"/m",m^{3},")"))) 

```

\newpage
#### figure 3.3.12.3. Platelets count level within trimester by site 
```{r}
df_platelets_level <- df_platelets %>%
  filter(!is.na(trimester))

plot_bar(df_platelets_level, df_platelets_level$platelets_level, "Platelets count level") 
```

* Platelets count (x10³/mm³) level are defined as:
```{r echo=FALSE, results='asis'}
tb_platelets_level <- data.frame(
  "Level" = c("High", "Normal", "Low"), 
  "Trimester 1" = c("> 391", "174 - 391", "< 174"),
  "Trimester 2" = c("> 409", "155 - 409", "< 155"),
  "Trimester 3" = c("> 429", "146 - 429", "< 146")
)
knitr::kable(tb_platelets_level)
```

\newpage
### Monocyte (%) 

#### figure 3.3.13.1. Monocyte (%) distribution by gestational age (GA) and PNC visits by site
```{r}
#scatter plot
df_monocyte <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, CBC_MONO_PCT_LBORRES, trimester, time) %>% 
  filter(!is.na(CBC_MONO_PCT_LBORRES) & !is.na(time)) 

plot_point(df_monocyte, df_monocyte$CBC_MONO_PCT_LBORRES, "Monocyte (%)") +
  ylab(expression(paste("Monocyte (%)"))) 

```

\newpage
#### figure 3.3.13.2. Monocyte (%) site comparison by gestational age (GA) and PNC visits 
```{r}
plot_line(df_monocyte, df_monocyte$CBC_MONO_PCT_LBORRES) +
  ylab(expression(paste("Monocyte (%)"))) 
```

\newpage
### Monocyte (full cell count) 

#### figure 3.3.14.1. Monocyte (full cell count) distribution by gestational age (GA) and PNC visits by site
```{r}
#scatter plot
df_monocyte_count <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, CBC_MONO_FCC_LBORRES, monocyte_level, trimester, time) %>% 
  filter(!is.na(CBC_MONO_FCC_LBORRES) & !is.na(time)) 

plot_point(df_monocyte_count, df_monocyte_count$CBC_MONO_FCC_LBORRES, "Monocyte (full cell count)") +
  ylab(expression(paste("Monocyte (full cell count) (x",10^{3},"/m",m^{3},")"))) 

```

\newpage
#### figure 3.3.14.2. Monocyte (full cell count) site comparison by gestational age (GA) and PNC visits 
```{r}
plot_line(df_monocyte_count, df_monocyte_count$CBC_MONO_FCC_LBORRES) +
  ylab(expression(paste("Monocyte (full cell count) (x",10^{3},"/m",m^{3},")"))) 
```

\newpage
#### figure 3.3.14.3. Monocyte (full cell count) level within trimester by site 
```{r}
df_monocyte_level <- df_monocyte_count %>%
  filter(!is.na(trimester))

plot_bar(df_monocyte_level, df_monocyte_level$monocyte_level, "Monocyte (full cell count) level") 
```

* Monocyte (full cell count) (x10³/mm³) level are defined as:
```{r echo=FALSE, results='asis'}
tb_monocyte_level <- data.frame(
  "Level" = c("High", "Normal", "Low"), 
  "Trimester 1" = c("> 1.1", "0.1 - 1.1", "< 0.1"),
  "Trimester 2" = c("> 1.1", "0.1 - 1.1", "< 0.1"),
  "Trimester 3" = c("> 1.4", "0.1 - 1.4", "< 0.1")
)
knitr::kable(tb_monocyte_level)
```

\newpage
### Eosinophils (%)

#### figure 3.3.15.1. Eosinophils (%) distribution by gestational age (GA) and PNC visits by site
```{r}
#scatter plot
df_eosinophils <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, CBC_EOS_PCT_LBORRES, trimester, time) %>% 
  filter(!is.na(CBC_EOS_PCT_LBORRES) & !is.na(time))  

plot_point(df_eosinophils, df_eosinophils$CBC_EOS_PCT_LBORRES, "Eosinophils") +
  ylab(expression(paste("Eosinophils (%)"))) +
  scale_y_continuous(limits = c(0,NA))

```

\newpage
#### figure 3.3.15.2. Eosinophils (%) site comparison by gestational age (GA) and PNC visits 
```{r}
plot_line(df_eosinophils, df_eosinophils$CBC_EOS_PCT_LBORRES) +
  ylab(expression(paste("Eosinophils (%)"))) +
  scale_y_continuous(limits = c(0,NA))

```

\newpage
### Eosinophils (full cell count)

#### figure 3.3.16.1. Eosinophils (full cell count) distribution by gestational age (GA) and PNC visits by site
```{r}
#scatter plot
df_eosinophils_c <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, CBC_EOS_FCC_LBORRES, eosinophils_level, trimester, time) %>% 
  filter(!is.na(CBC_EOS_FCC_LBORRES) & !is.na(time)) 

plot_point(df_eosinophils_c, df_eosinophils_c$CBC_EOS_FCC_LBORRES, "Eosinophils (full cell count)") +
  ylab(expression(paste("Eosinophils (full cell count) (x",10^{3},"/m",m^{3},")"))) +
  scale_y_continuous(limits = c(0,NA))

```

\newpage
#### figure 3.3.16.2. Eosinophils (full cell count) site comparison by gestational age (GA) and PNC visits 
```{r}
plot_line(df_eosinophils_c, df_eosinophils_c$CBC_EOS_FCC_LBORRES) +
  ylab(expression(paste("Eosinophils (full cell count) (x",10^{3},"/m",m^{3},")"))) +
  scale_y_continuous(limits = c(0,NA))

```

\newpage
#### figure 3.3.16.3. Eosinophils (full cell count) level within trimester by site 
```{r}
df_eosinophils_level <- df_eosinophils_c %>%
  filter(!is.na(trimester))

plot_bar(df_eosinophils_level, df_eosinophils_level$eosinophils_level, "Eosinophils (full cell count) level") 

```

* Eosinophils (full cell count) (x10³/mm³) level are defined as:
```{r echo=FALSE, results='asis'}
tb_eosinophils_level <- data.frame(
  "Level" = c("High", "Normal", "Low"), 
  "Trimester 1" = c("> 0.6", "0 - 0.6", "< 0"),
  "Trimester 2" = c("> 0.6", "0 - 0.6", "< 0"),
  "Trimester 3" = c("> 0.6", "0 - 0.6", "< 0")
)
knitr::kable(tb_eosinophils_level)
```

\newpage
### Red cell width (%) 

#### figure 3.3.17.1. Red cell width (%) distribution by gestational age (GA) and PNC visits by site
```{r}
#scatter plot
df_rdw <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, CBC_RDW_PCT_LBORRES, rdw_level, trimester, time) %>% 
  filter(!is.na(CBC_RDW_PCT_LBORRES) & !is.na(time)) 

plot_point(df_rdw, df_rdw$CBC_RDW_PCT_LBORRES, "Red cell width") +
  ylab(expression(paste("Red cell width (%)"))) 

```

\newpage
#### figure 3.3.17.2. Red cell width (%) site comparison by gestational age (GA) and PNC visits 
```{r}
plot_line(df_rdw, df_rdw$CBC_RDW_PCT_LBORRES) +
  ylab(expression(paste("Red cell width (%)"))) 
```

\newpage
#### figure 3.3.17.3. Red cell width (%) level within trimester by site 
```{r}
df_rdw_level <- df_rdw %>%
  filter(!is.na(trimester))

plot_bar(df_rdw_level, df_rdw_level$rdw_level, "Red cell width (%) level") 
```

* RCW (%) level are defined as:
```{r echo=FALSE, results='asis'}
tb_rcd_level <- data.frame(
  "Level" = c("High", "Normal", "Low"), 
  "Trimester 1" = c("> 14.9", "11.7 - 14.9", "< 11.7"),
  "Trimester 2" = c("> 14.7", "12.3 - 14.7", "< 12.3"),
  "Trimester 3" = c("> 16.6", "11.4 - 16.6", "< 11.4")
)
knitr::kable(tb_rcd_level)
```

\newpage
### Platelet distribution width (PDW) 

#### figure 3.3.18.1. Platelet distribution width (PDW) distribution by gestational age (GA) and PNC visits by site
```{r}
#scatter plot
df_pdw <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, CBC_PDW_CT_LBORRES,  trimester, time) %>%  
  filter(!is.na(CBC_PDW_CT_LBORRES) & !is.na(time))  

plot_point(df_pdw, df_pdw$CBC_PDW_CT_LBORRES, "PDW") +
  ylab(expression(paste("Platelet distribution width (fL)"))) 

```

\newpage
#### figure 3.3.18.2. Platelet distribution width (PDW) site comparison by gestational age (GA) and PNC visits 
```{r}
plot_line(df_pdw, df_pdw$CBC_PDW_CT_LBORRES) +
  ylab(expression(paste("Platelet distribution width (x",10^{3},"/m",m^{3},")"))) 

```

\newpage
### Plateletcrit (PCT) (%)

#### figure 3.3.19.1. Plateletcrit (PCT) (%) distribution by gestational age (GA) and PNC visits by site
```{r}
#scatter plot
df_pct <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, CBC_PCT_PCT_LBORRES,  trimester, time) %>% 
  filter(!is.na(CBC_PCT_PCT_LBORRES) & !is.na(time)) 

plot_point(df_pct, df_pct$CBC_PCT_PCT_LBORRES, "PCT") +
  ylab(expression(paste("Plateletcrit (PCT) (%)"))) 

```

\newpage
#### figure 3.3.19.2. Plateletcrit (PCT) (%) site comparison by gestational age (GA) and PNC visits 
```{r}
plot_line(df_pct, df_pct$CBC_PCT_PCT_LBORRES) +
  ylab(expression(paste("Plateletcrit (PCT) (%)"))) 
```

\newpage
## Liver Function test (LFT) results (MNH08)

### AST/SGOT test results

#### figure 3.4.1.1. AST/SGOT distribution by gestational age (GA) 
```{r}
#scatter plot
df_ast <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, AST_UL_LBORRES, trimester, time) %>% 
  filter(!is.na(AST_UL_LBORRES) & !is.na(time)) 

plot_point(df_ast, df_ast$AST_UL_LBORRES, "AST/SGOT") +
  ylab(expression(paste("AST/SGOT (Units/L)")))

```

\newpage
#### figure 3.4.1.2. AST/SGOT site comparison by gestational age (GA) 
```{r}
plot_line(df_ast, df_ast$AST_UL_LBORRES) +
  ylab(expression(paste("AST/SGOT (Units/L)"))) 

```

\newpage
### ALT/SGPT test results

#### figure 3.4.2.1. ALT/SGPT distribution by gestational age (GA) 
```{r}
#scatter plot
df_alt <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, ALT_UL_LBORRES, trimester, time) %>% 
  filter(!is.na(ALT_UL_LBORRES) & !is.na(time)) 

plot_point(df_alt, df_alt$ALT_UL_LBORRES, "ALT/SGPT") +
  ylab(expression(paste("ALT/SGPT (Units/L)")))

```

\newpage
#### figure 3.4.2.2. ALT/SGPT site comparison by gestational age (GA)
```{r}
plot_line(df_alt, df_alt$ALT_UL_LBORRES) +
  ylab(expression(paste("ALT/SGPT (Units/L)"))) 
```

\newpage
### Alkaline phosphatase (ALP) test results 

#### figure 3.4.3.1. Alkaline phosphatase (ALP) distribution by gestational age (GA) 
```{r}
#scatter plot
df_alp <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, ALP_LBORRES, trimester, time) %>% 
  filter(!is.na(ALP_LBORRES) & !is.na(time)) 

plot_point(df_alp, df_alp$ALP_LBORRES, "ALP") +
  ylab(expression(paste("Alkaline phosphatase (Units/L)"))) 

```

\newpage
#### figure 3.4.3.2. Alkaline phosphatase (ALP) site comparison by gestational age (GA) 
```{r}
plot_line(df_alp, df_alp$ALP_LBORRES) +
  ylab(expression(paste("Alkaline phosphatase (Units/L)"))) 
```

\newpage
### Total Bilirubin test results 

#### figure 3.4.4.1. Total Bilirubin distribution by gestational age (GA) 
```{r}
#scatter plot
df_tot_bilirubin <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, TBILIRUBIN_LBORRES, trimester, time) %>% 
  filter(!is.na(TBILIRUBIN_LBORRES) & !is.na(time)) 

plot_point(df_tot_bilirubin, df_tot_bilirubin$TBILIRUBIN_LBORRES, "Total Bilirubin") +
  ylab(expression(paste("Total Bilirubin (µmol/L)")))

```

\newpage
#### figure 3.4.4.2. Total Bilirubin site comparison by gestational age (GA) 
```{r}
plot_line(df_tot_bilirubin, df_tot_bilirubin$TBILIRUBIN_LBORRES) +
  ylab(expression(paste("Total Bilirubin (µmol/L)")))
```

\newpage
### Direct Bilirubin test results 

#### figure 3.4.5.1. Direct Bilirubin distribution by gestational age (GA) 
```{r}
#scatter plot
df_dir_bilirubin <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, DBILIRUBIN_LBORRES, trimester, time) %>% 
  filter(!is.na(DBILIRUBIN_LBORRES) & !is.na(time)) 

plot_point(df_dir_bilirubin, df_dir_bilirubin$DBILIRUBIN_LBORRES, "Direct Bilirubin ") +
  ylab(expression(paste("Direct Bilirubin  (µmol/L)")))

```

\newpage
#### figure 3.4.5.2. Direct Bilirubin site comparison by gestational age (GA) 
```{r}
plot_line(df_dir_bilirubin, df_dir_bilirubin$DBILIRUBIN_LBORRES) +
  ylab(expression(paste("Direct Bilirubin (µmol/L)"))) 
```

\newpage
### Total Protein test results 

#### figure 3.4.6.1. Total Protein distribution by gestational age (GA) 
```{r}
#scatter plot
df_tot_protein <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, TPROTEIN_LBORRES, mcv_level, trimester, time) %>% 
  filter(!is.na(TPROTEIN_LBORRES) & !is.na(time)) 

plot_point(df_tot_protein, df_tot_protein$TPROTEIN_LBORRES, "Total Protein") +
  ylab(expression(paste("Total Protein (g/l)"))) 

```

\newpage
#### figure 3.4.6.2. Total Protein site comparison by gestational age (GA) 
```{r}
plot_line(df_tot_protein, df_tot_protein$TPROTEIN_LBORRES) +
  ylab(expression(paste("Total Protein (g/l)"))) 
```

\newpage
### Albumin test results 

#### figure 3.4.7.1. Albumin distribution by gestational age (GA) 
```{r}
#scatter plot
df_albumin <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, ALBUMIN_LBORRES, trimester, time) %>% 
  filter(!is.na(ALBUMIN_LBORRES) & !is.na(time)) 

plot_point(df_albumin, df_albumin$ALBUMIN_LBORRES, "Albumin") +
  ylab(expression(paste("Albumin (g/dL)")))

```

\newpage
#### figure 3.4.7.2. Albumin site comparison by gestational age (GA) 
```{r}
plot_line(df_albumin, df_albumin$ALBUMIN_LBORRES) +
  ylab(expression(paste("Albumin (g/dL)"))) 

```

\newpage
### Gamma GT test results 

#### figure 3.4.8.1. Gamma GT distribution by gestational age (GA)
```{r}
#scatter plot
df_gamma <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, GAMMAGT_LBORRES, trimester, time) %>% 
  filter(!is.na(GAMMAGT_LBORRES) & !is.na(time)) 

plot_point(df_gamma, df_gamma$GAMMAGT_LBORRES, "Gamma GT") +
  ylab(expression(paste("Gamma GT (units/L)")))

```

\newpage
#### figure 3.4.8.2. Gamma GT site comparison by gestational age (GA) 
```{r}
plot_line(df_gamma, df_gamma$GAMMAGT_LBORRES) +
  ylab(expression(paste("Gamma GT (units/L)")))
```

\newpage
### Indirect Bilirubin test results 

#### figure 3.4.9.1. Indirect Bilirubin distribution by gestational age (GA)
```{r}
#scatter plot
df_ind_bilirubin <- df_lab_08_l %>% 
  select(MOMID, PREGID, SITE, ga_wks, IBILIRUBIN_LBORRES, trimester, time) %>% 
  filter(!is.na(IBILIRUBIN_LBORRES) & !is.na(time)) 

plot_point(df_ind_bilirubin, df_ind_bilirubin$IBILIRUBIN_LBORRES, "Indirect Bilirubin") +
  ylab(expression(paste("Indirect Bilirubin (µmol/L)")))

```

\newpage
#### figure 3.4.9.2. Indirect Bilirubin site comparison by gestational age (GA)
```{r}
plot_line(df_ind_bilirubin, df_ind_bilirubin$IBILIRUBIN_LBORRES) +
  ylab(expression(paste("Indirect Bilirubin (µmol/L)"))) 
```

\newpage
## Kidney (Renal) Function test results (MNH08)

### BUN test results

#### figure 3.5.1.1. BUN distribution by gestational age (GA)
```{r}
# scatter plot
df_bun <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, BUN_MMOLL_LBORRES, trimester, time) %>% 
  filter(!is.na(BUN_MMOLL_LBORRES) & !is.na(time)) 

plot_point(df_bun, df_bun$BUN_MMOLL_LBORRES, "BUN") +
  ylab(expression(paste("BUN (mmol/L)")))

```

\newpage
#### figure 3.5.1.2. BUN site comparison by gestational age (GA) 
```{r}
plot_line(df_bun, df_bun$BUN_MMOLL_LBORRES) +
  ylab(expression(paste("BUN (mmol/L)")))
```

\newpage
### Serum creatinine test results

#### figure 3.5.2.1. Serum creatinine distribution by gestational age (GA) 
```{r}
# scatter plot
df_creat <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, CREAT_UMOLL_LBORRES, trimester, time) %>% 
  filter(!is.na(CREAT_UMOLL_LBORRES) & !is.na(time)) 

plot_point(df_creat, df_creat$CREAT_UMOLL_LBORRES, "Serum creatinine") +
  ylab(expression(paste("Serum creatinine (µmol/L)")))

```

\newpage
#### figure 3.5.2.2. Serum creatinine site comparison by gestational age (GA) 
```{r}
plot_line(df_creat, df_creat$CREAT_UMOLL_LBORRES) +
  ylab(expression(paste("Serum creatinine (µmol/L)")))
```

\newpage
### Sodium test results

#### figure 3.5.3.1. Sodium distribution by gestational age (GA)
```{r}
# scatter plot
df_sodium <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, SODIUM_LBORRES, trimester, time) %>% 
  filter(!is.na(SODIUM_LBORRES) & !is.na(time)) 

plot_point(df_sodium, df_sodium$SODIUM_LBORRES, "Sodium") +
  ylab(expression(paste("Sodium (mmol/L)")))

```

\newpage
#### figure 3.5.3.2. Sodium site comparison by gestational age (GA)
```{r}
plot_line(df_sodium, df_sodium$SODIUM_LBORRES) +
  ylab(expression(paste("Sodium (mmol/L)")))
```

\newpage
### Potassium test results

#### figure 3.5.4.1. Potassium distribution by gestational age (GA) 
```{r}
# scatter plot
df_potassium <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, POTASSIUM_LBORRES, trimester, time) %>% 
  filter(!is.na(POTASSIUM_LBORRES) & !is.na(time)) 

plot_point(df_potassium, df_potassium$POTASSIUM_LBORRES, "Potassium") +
  ylab(expression(paste("Potassium (mmol/L)")))

```

\newpage
#### figure 3.5.4.2. Potassium site comparison by gestational age (GA) 
```{r}
plot_line(df_potassium, df_potassium$POTASSIUM_LBORRES) +
  ylab(expression(paste("Potassium (mmol/L)")))
```

\newpage
### Chloride test results

#### figure 3.5.5.1. Chloride distribution by gestational age (GA) 
```{r}
# scatter plot
df_chloride <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, CHLORIDE_LBORRES, trimester, time) %>% 
  filter(!is.na(CHLORIDE_LBORRES) & !is.na(time)) 

plot_point(df_chloride, df_chloride$CHLORIDE_LBORRES, "Chloride") +
  ylab(expression(paste("Chloride (mmol/L)")))

```

\newpage
#### figure 3.5.5.2. Chloride site comparison by gestational age (GA) 
```{r}
plot_line(df_chloride, df_chloride$CHLORIDE_LBORRES) +
  ylab(expression(paste("Chloride (mmol/L)")))
```

\newpage
### Phosphorus test results

#### figure 3.5.6.1. Phosphorus distribution by gestational age (GA)
```{r}
# scatter plot
df_bun <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, BUN_MMOLL_LBORRES, trimester, time) %>% 
  filter(!is.na(BUN_MMOLL_LBORRES) & !is.na(time))  

plot_point(df_bun, df_bun$BUN_MMOLL_LBORRES, "Phosphorus") +
  ylab(expression(paste("Phosphorus (mmol/L)")))

```

\newpage
#### figure 3.5.6.2. Phosphorus site comparison by gestational age (GA) 
```{r}
plot_line(df_bun, df_bun$BUN_MMOLL_LBORRES) +
  ylab(expression(paste("Phosphorus (mmol/L)")))
```

\newpage
### Calcium test results

#### figure 3.5.7.1. Calcium distribution by gestational age (GA) 
```{r}
# scatter plot
df_calcium <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, CALCIUM_LBORRES, trimester, time) %>% 
  filter(!is.na(CALCIUM_LBORRES) & !is.na(time)) 

plot_point(df_calcium, df_calcium$CALCIUM_LBORRES, "Calcium") +
  ylab(expression(paste("Calcium (mmol/L)")))

```

\newpage
#### figure 3.5.7.2. Calcium site comparison by gestational age (GA) 
```{r}
plot_line(df_calcium, df_calcium$CALCIUM_LBORRES) +
  ylab(expression(paste("Calcium (mmol/L)")))
```

\newpage
### Carbon dioxide test results

#### figure 3.5.8.1. Carbon dioxide distribution by gestational age (GA) 
```{r}
# scatter plot
df_carb_diox <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, CARB_DIOX_LBORRES, trimester, time) %>% 
  filter(!is.na(CARB_DIOX_LBORRES) & !is.na(time)) 

plot_point(df_carb_diox, df_carb_diox$CARB_DIOX_LBORRES, "Carbon dioxide") +
  ylab(expression(paste("Carbon dioxide (mmol/L)")))

```

\newpage
#### figure 3.5.8.2. Carbon dioxide site comparison by gestational age (GA) 
```{r}
plot_line(df_carb_diox, df_carb_diox$CARB_DIOX_LBORRES) +
  ylab(expression(paste("Carbon dioxide (mmol/L)")))
```

\newpage
### Magnesium test results

#### figure 3.5.9.1. Magnesium distribution by gestational age (GA) 
```{r}
# scatter plot
df_magnesium <- df_lab_08_l %>%
  #Magnesium is optional and not performed at India-CMC or Kenya
  filter(!SITE %in% c("India-CMC", "Kenya")) %>% 
  select(MOMID, PREGID, SITE, ga_wks, MAGNESIUM_LBORRES, trimester, time) %>% 
  filter(!is.na(MAGNESIUM_LBORRES) & !is.na(time)) 

plot_point(df_magnesium, df_magnesium$MAGNESIUM_LBORRES, "Magnesium") +
  ylab(expression(paste("Magnesium (mmol/L)")))

```
- Magnesium is optional and not performed at India-CMC or Kenya

\newpage
#### figure 3.5.9.2. Magnesium site comparison by gestational age (GA) 
```{r}
plot_line(df_magnesium, df_magnesium$MAGNESIUM_LBORRES) +
  ylab(expression(paste("Magnesium (mmol/L)")))
```

\newpage
## Micronutrient Test Results

### Serum Vitamin B12: Total Cobalamin test results

#### figure 3.6.1.1. Serum Vitamin B12: Total Cobalamin distribution by gestational age (GA) and PNC visits by site
```{r}
# scatter plot
df_b12tc <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, VITB12_COB_LBORRES, trimester, time, b12tc_level) %>% 
  filter(!is.na(VITB12_COB_LBORRES) & !is.na(time)) 

plot_point(df_b12tc, df_b12tc$VITB12_COB_LBORRES, "Total Cobalamin") +
  ylab(expression(paste("Serum Vitamin B12: Total Cobalamin (pg/mL)"))) 

```

\newpage
#### figure 3.6.1.2. Serum Vitamin B12: Total Cobalamin site comparison by gestational age (GA) and PNC visits
```{r}
plot_line(df_b12tc, df_b12tc$VITB12_COB_LBORRES) +
  ylab(expression(paste("Serum Vitamin B12: Total Cobalamin (pg/mL)"))) 

```

\newpage
#### figure 3.6.1.3. Serum Vitamin B12: Total Cobalamin level within trimester by site
```{r}
df_b12tc_level <- df_b12tc %>%
  filter(!is.na(trimester)) 

plot_bar(df_b12tc_level, df_b12tc_level$b12tc_level, "Vit B12 TC level") 

```

* Serum Vitamin B12: Total Cobalamin (pg/mL) level are defined as:
```{r echo=FALSE, results='asis'}
tb_b12tc_level <- data.frame(
  "Level" = c("High", "Normal", "Low"), 
  "Trimester 1" = c("> 438", "118 - 438", "< 118"),
  "Trimester 2" = c("> 656", "130 - 656", "< 130"),
  "Trimester 3" = c("> 526", "99 - 526", "< 99")
)
knitr::kable(tb_b12tc_level)
```


\newpage
### Serum Vitamin B12: Holotranscobalamin II test results

#### figure 3.6.2.1. Serum Vitamin B12: Holotranscobalamin II distribution by gestational age (GA) and PNC visits by site
```{r}
# scatter plot
df_vitb12_hol <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, VITB12_HOL_LBORRES, trimester, time) %>% 
  filter(!is.na(VITB12_HOL_LBORRES) & !is.na(time)) 

plot_point(df_vitb12_hol, df_vitb12_hol$VITB12_HOL_LBORRES, "Holotranscobalamin II") +
  ylab(expression(paste("Serum Vitamin B12: Holotranscobalamin II (pg/mL)")))

```

\newpage
#### figure 3.6.2.2. Serum Vitamin B12: Holotranscobalamin II site comparison by gestational age (GA) and PNC visits
```{r}
plot_line(df_vitb12_hol, df_vitb12_hol$VITB12_HOL_LBORRES) +
  ylab(expression(paste("Serum Vitamin B12: Holotranscobalamin II (pg/mL)"))) 

```

\newpage
### Folate: Blood serum test results

#### figure 3.6.3.1. Folate: Blood serum results distribution by gestational age (GA) and PNC visits by site
```{r}
# # scatter plot
df_folate <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, FOLATE_PLASMA_NMOLL_LBORRES, trimester, time) %>% 
  filter(!is.na(FOLATE_PLASMA_NMOLL_LBORRES) & !is.na(time)) 

if (nrow(df_folate) > 0) {
  plot_histo(df_folate, df_folate$FOLATE_PLASMA_NMOLL_LBORRES, "Folate: Blood serum")
} else {print("Figure will be generated when more data points are available")}


```

\newpage
#### figure 3.6.3.2. Folate: Blood serum results site comparison by gestational age (GA) and PNC visits
```{r}
plot_line(df_folate, df_folate$FOLATE_PLASMA_NMOLL_LBORRES) +
  ylab(expression(paste("Folate: Blood serum (nmol/L)")))
```

\newpage
### Ferritin test results

#### figure 3.6.4.1. Ferritin distribution by gestational age (GA) and PNC visits by site
```{r}
# scatter plot
df_ferritin <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, FERRITIN_LBORRES, trimester, time, ferritin_level) %>% 
  filter(!is.na(FERRITIN_LBORRES) & !is.na(time)) 

plot_point(df_ferritin, df_ferritin$FERRITIN_LBORRES, "Ferritin") +
  ylab(expression(paste("Ferritin (µg/dL)"))) 

```

\newpage
#### figure 3.6.4.2. Ferritin site comparison by gestational age (GA) and PNC visits
```{r}
plot_line(df_ferritin, df_ferritin$FERRITIN_LBORRES) +
  ylab(expression(paste("Ferritin (µg/dL)"))) 

```

\newpage
#### figure 3.6.4.3. Ferritin level within trimester by site
```{r}
df_ferritin_level <- df_ferritin %>%
  filter(!is.na(trimester)) 

plot_bar(df_ferritin_level, df_ferritin_level$ferritin_level, "Ferritin level") 

```

* Ferritin (µg/dL) level are defined as:
```{r echo=FALSE, results='asis'}
tb_ferritin_level <- data.frame(
  "Level" = c("High", "Normal", "Low"), 
  "Trimester 1" = c("> 12.5", "0.6 - 12.5", "< 0.6"),
  "Trimester 2" = c("> 7.4", "0.6 - 7.4", "< 0.6"),
  "Trimester 3" = c("> 5.8", "0.3 - 5.8", "< 0.3")
)
knitr::kable(tb_ferritin_level)
```


\newpage
### Iodine (thyroglobulin or Tg) test results

#### figure 3.6.5.1. Iodine (thyroglobulin or Tg) distribution by gestational age (GA) and PNC visits by site
```{r}
# scatter plot
df_iodine <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, IODINE_LBORRES, trimester, time) %>% 
  filter(!is.na(IODINE_LBORRES) & !is.na(time)) 

plot_point(df_iodine, df_iodine$IODINE_LBORRES, "Iodine") +
  ylab(expression(paste("Iodine (thyroglobulin or Tg) (µg/L)")))

```

\newpage
#### figure 3.6.5.2. Iodine (thyroglobulin or Tg) site comparison by gestational age (GA) and PNC visits
```{r}
plot_line(df_iodine, df_iodine$IODINE_LBORRES) +
  ylab(expression(paste("Iodine (thyroglobulin or Tg) (µg/L)")))

```

\newpage
### Serum Transferrin receptor (sTfR) test results

#### figure 3.6.6.1. Serum Transferrin receptor (sTfR) distribution by gestational age (GA) and PNC visits by site
```{r}
# scatter plot
df_stfr <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, TRANSFERRIN_LBORRES, trimester, time) %>% 
  filter(!is.na(TRANSFERRIN_LBORRES) & !is.na(time)) 

plot_point(df_stfr, df_stfr$TRANSFERRIN_LBORRES, "STFR") +
  ylab(expression(paste("Serum Transferrin receptor (sTfR) (mg/L)")))

```

\newpage
#### figure 3.6.6.2. Serum Transferrin receptor site comparison by gestational age (GA) and PNC visits
```{r}
plot_line(df_stfr, df_stfr$TRANSFERRIN_LBORRES) +
  ylab(expression(paste("Serum Transferrin receptor (mg/L)")))
```

\newpage
### Retinol protein binding 4 (RBP4) test results

#### figure 3.6.7.1. Retinol protein binding 4 (RBP4) distribution by gestational age (GA) and PNC visits by site
```{r}
# scatter plot
df_rbp4 <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, RBP4_LBORRES, trimester, time) %>% 
  filter(!is.na(RBP4_LBORRES) & !is.na(time)) 

plot_point(df_rbp4, df_rbp4$RBP4_LBORRES, "RBP4") +
  ylab(expression(paste("Retinol protein binding 4 (RBP4) (µmol/L)")))

```

\newpage
#### figure 3.6.7.2. Retinol protein binding 4 (RBP4) site comparison by gestational age (GA) and PNC visits
```{r}
plot_line(df_rbp4, df_rbp4$RBP4_LBORRES) +
  ylab(expression(paste("Retinol protein binding 4 (RBP4) (µmol/L)")))
```

\newpage
### C-reactive protein (CRP) test results

#### figure 3.6.8.1. C-reactive protein (CRP) distribution by gestational age (GA) and PNC visits by site
```{r}
# scatter plot
df_crp <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, CRP_LBORRES, trimester, time) %>% 
  filter(!is.na(CRP_LBORRES) & !is.na(time)) 

plot_point(df_crp, df_crp$CRP_LBORRES, "CRP") +
  ylab(expression(paste("C-reactive protein (CRP) (mg/L)")))

```

\newpage
#### figure 3.6.8.2. C-reactive protein (CRP) site comparison by gestational age (GA) and PNC visits
```{r}
plot_line(df_crp, df_crp$CRP_LBORRES) +
  ylab(expression(paste("C-reactive protein (CRP) (mg/L)")))
```

\newpage
### Alpha 1-acid glycoprotein (AGP) test results

#### figure 3.6.9.1. Alpha 1-acid glycoprotein (AGP) distribution by gestational age (GA) and PNC visits by site
```{r}
# scatter plot
df_agp <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, AGP_LBORRES, trimester, time) %>% 
  filter(!is.na(AGP_LBORRES) & !is.na(time)) 

plot_point(df_agp, df_agp$AGP_LBORRES, "AGP") +
  ylab(expression(paste("Alpha 1-acid glycoprotein (AGP) (g/L)")))

```

\newpage
#### figure 3.6.9.2. Alpha 1-acid glycoprotein (AGP) site comparison by gestational age (GA) and PNC visits
```{r}
plot_line(df_agp, df_agp$AGP_LBORRES) +
  ylab(expression(paste("Alpha 1-acid glycoprotein (AGP) (g/L)")))
```

\newpage
### Histidine-rich protein 2 (HRP) test results

#### figure 3.6.10.1. Histidine-rich protein 2 (HRP) distribution by gestational age (GA) and PNC visits by site
```{r}
# scatter plot
df_hrp <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, HRP_LBORRES, trimester, time) %>% 
  filter(!is.na(HRP_LBORRES) & !is.na(time)) 

plot_point(df_hrp, df_hrp$HRP_LBORRES, "HRP") +
  ylab(expression(paste("Histidine-rich protein 2 (HRP) (ug/mL)")))

```

\newpage
#### figure 3.6.10.2. Histidine-rich protein 2 (HRP) site comparison by gestational age (GA) and PNC visits
```{r}
plot_line(df_hrp, df_hrp$HRP_LBORRES) +
  ylab(expression(paste("Histidine-rich protein 2 (HRP) (ug/mL)")))
```

\newpage
## Thyroid Panel results (MNH08)

### TSH test results

#### figure 3.7.1.1. TSH distribution by gestational age (GA)
```{r}
# scatter plot
df_tsh <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, THYROID_TSH_LBORRES, trimester, time) %>% 
  filter(!is.na(THYROID_TSH_LBORRES) & !is.na(time)) 

plot_point(df_tsh, df_tsh$THYROID_TSH_LBORRES, "TSH") +
  ylab(expression(paste("TSH (μIU/mL)")))

```

\newpage
#### figure 3.7.1.2. TSH site comparison by gestational age (GA)
```{r}
plot_line(df_tsh, df_tsh$THYROID_TSH_LBORRES) +
  ylab(expression(paste("TSH (μIU/mL)")))
```

\newpage
### Free T4 test results

#### figure 3.7.2.1. Free T4 distribution by gestational age (GA)
```{r}
# scatter plot
df_freet4 <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, THYROID_FREET4_LBORRES, trimester, time, freet4_level) %>% 
  filter(!is.na(THYROID_FREET4_LBORRES) & !is.na(time)) 

plot_point(df_freet4, df_freet4$THYROID_FREET4_LBORRES, "Free T4") +
  ylab(expression(paste("Free T4 (ng/dL)"))) 

```


\newpage
#### figure 3.7.2.2. Free T4 site comparison by gestational age (GA) 
```{r}
plot_line(df_freet4, df_freet4$THYROID_FREET4_LBORRES) +
  ylab(expression(paste("Free T4 (ng/dL)"))) 

```

\newpage
#### figure 3.7.2.3. Free T4 (ng/dL) level within trimester by site
```{r}
df_freet4_level <- df_freet4 %>%
  filter(!is.na(trimester)) 

plot_bar(df_freet4_level, df_freet4_level$freet4_level, "Free T4 level") 

```

* Free T4 (ng/dL) level are defined as:
```{r echo=FALSE, results='asis'}
tb_freet4_level <- data.frame(
  "Level" = c("High", "Normal", "Low"), 
  "Trimester 1" = c("> 1.37", "0.55 - 1.37", "< 0.55"),
  "Trimester 2" = c("> 1.09", "0.55 - 1.09", "< 0.55"),
  "Trimester 3" = c("> 1.09", "0.55 - 1.09", "< 0.55")
)
knitr::kable(tb_freet4_level)
```

\newpage
### Free T3 test results

#### figure 3.7.3.1. Free T3 distribution by gestational age (GA) 
```{r}
# scatter plot
df_freet3 <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, THYROID_FREET3_LBORRES, trimester, time) %>% 
  filter(!is.na(THYROID_FREET3_LBORRES) & !is.na(time)) 

plot_point(df_freet3, df_freet3$THYROID_FREET3_LBORRES, "Free T3") +
  ylab(expression(paste("Free T3 (pg/dL)")))

```

\newpage
#### figure 3.7.3.2. Free T3 site comparison by gestational age (GA) 
```{r}
plot_line(df_freet3, df_freet3$THYROID_FREET3_LBORRES) +
  ylab(expression(paste("Free T3 (pg/dL)")))
```

\newpage
## Oral glucose tolerance test results (MNH08)

### figure 3.8.1. Fasting glucose distribution at ANC 28 visit by site with high blood glucose line (5.1 mmol/L)
```{r}
#histogram
df_fast_glucose <- df_lab_08_l %>%
  filter(TYPE_VISIT == 3) %>% 
  select(MOMID, PREGID, SITE, BGLUC_PRETEST_MMOLL_LBORRES) %>% 
  filter(!is.na(BGLUC_PRETEST_MMOLL_LBORRES)) 

plot_fast_glucose <- df_fast_glucose %>% 
  ggplot(aes(x = BGLUC_PRETEST_MMOLL_LBORRES)) +
  geom_histogram(alpha = 0.8, binwidth = 0.1, fill = "#FF0000") +
  xlab ("Fasting Blood Glucose (mmol/L)") +
  ylab("Frequency") +
  scale_x_continuous(
    breaks = seq(floor(min(df_fast_glucose$BGLUC_PRETEST_MMOLL_LBORRES)), max(df_fast_glucose$BGLUC_PRETEST_MMOLL_LBORRES), max(0.5, floor((max(df_fast_glucose$BGLUC_PRETEST_MMOLL_LBORRES)-min(df_fast_glucose$BGLUC_PRETEST_MMOLL_LBORRES))/50)))) +
  facet_grid(SITE ~ ., scales = "free_y") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust= 0.5),
        axis.text = element_text(size = 8), 
        legend.position = "none", 
        panel.grid.minor = element_blank(),
        strip.background=element_rect(fill="white"), 
        strip.text = element_text(size = 8), 
  ) +
  geom_vline(xintercept = 5.1, color = "#9986a5")

plot_fast_glucose

```

* Gestational diabetes reference value: fast >= 5.1

\newpage
### figure 3.8.2. Oral glucose-tolerance (1-hour) test results distribution at ANC 28 visit by site with high blood glucose line (10 mmol/L)
```{r}
#histogram
df_glucose1h <- df_lab_08_l %>%
  filter(TYPE_VISIT == 3) %>% 
  select(MOMID, PREGID, SITE, BGLUC_ORAL_1HR_MMOLL_LBORRES) %>% 
  filter(!is.na(BGLUC_ORAL_1HR_MMOLL_LBORRES)) 

plot_glucose1h <- df_glucose1h %>% 
  ggplot(aes(x = BGLUC_ORAL_1HR_MMOLL_LBORRES)) +
  geom_histogram(alpha = 0.8, binwidth = 0.1, fill = "#00A08A") +
  xlab ("1-hour Blood Glucose (mmol/L)") +
  ylab("Frequency") +
  scale_x_continuous(
    breaks = seq(floor(min(df_glucose1h$BGLUC_ORAL_1HR_MMOLL_LBORRES)), max(df_glucose1h$BGLUC_ORAL_1HR_MMOLL_LBORRES), max(0.5, floor((max(df_glucose1h$BGLUC_ORAL_1HR_MMOLL_LBORRES)-min(df_glucose1h$BGLUC_ORAL_1HR_MMOLL_LBORRES))/50)))) +
  facet_grid(SITE ~ ., scales = "free_y") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust= 0.5),
        axis.text = element_text(size = 8), 
        legend.position = "none", 
        panel.grid.minor = element_blank(),
        strip.background=element_rect(fill="white"), 
        strip.text = element_text(size = 8), 
  ) +
  geom_vline(xintercept = 10, color = "#9986a5")

plot_glucose1h

```

* Gestational diabetes reference value: 1hr post >= 10

\newpage
### figure 3.8.3. Oral glucose-tolerance (2-hour) test results distribution at ANC 28 visit by site with high blood glucose line (8.5 mmol/L)
```{r}
#histogram
df_glucose2h <- df_lab_08_l %>%
  filter(TYPE_VISIT == 3) %>% 
  select(MOMID, PREGID, SITE, BGLUC_ORAL_2HR_MMOLL_LBORRES) %>% 
  filter(!is.na(BGLUC_ORAL_2HR_MMOLL_LBORRES)) 

plot_glucose2h <- df_glucose2h %>% 
  ggplot(aes(x = BGLUC_ORAL_2HR_MMOLL_LBORRES)) +
  geom_histogram(alpha = 0.8, binwidth = 0.1, fill = "#D8A499") +
  xlab ("2-hour Blood Glucose (mmol/L)") +
  ylab("Frequency") +
  scale_x_continuous(
    breaks = seq(floor(min(df_glucose2h$BGLUC_ORAL_2HR_MMOLL_LBORRES)), max(df_glucose2h$BGLUC_ORAL_2HR_MMOLL_LBORRES), max(0.5, floor((max(df_glucose2h$BGLUC_ORAL_2HR_MMOLL_LBORRES)-min(df_glucose2h$BGLUC_ORAL_1HR_MMOLL_LBORRES))/50)))) +
  facet_grid(SITE ~ ., scales = "free_y") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust= 0.5),
        axis.text = element_text(size = 8), 
        legend.position = "none", 
        panel.grid.minor = element_blank(),
        strip.background=element_rect(fill="white"), 
        strip.text = element_text(size = 8), 
  ) +
  geom_vline(xintercept = 8.5, color = "#9986a5")

plot_glucose2h

```

* Gestational diabetes reference value: 2hr post >= 8.5

\newpage
### figure 3.8.4. Mean blood glucose value at ANC 28 visit site comparision

```{r}
df_ogtt <- df_lab_08_l %>% 
  filter(TYPE_VISIT == 3) %>% 
  select(MOMID, PREGID, SITE, 
         BGLUC_PRETEST_MMOLL_LBORRES, BGLUC_ORAL_1HR_MMOLL_LBORRES, BGLUC_ORAL_2HR_MMOLL_LBORRES) %>% 
  filter(!is.na(BGLUC_PRETEST_MMOLL_LBORRES) | !is.na(BGLUC_ORAL_1HR_MMOLL_LBORRES) | !is.na(BGLUC_ORAL_2HR_MMOLL_LBORRES)) %>% 
  pivot_longer(-c(MOMID, PREGID, SITE),
               names_to = "OGTT", 
               values_to = "blood_glucose") %>% 
  group_by(SITE, OGTT) %>% 
  mutate(mean_bg = mean(blood_glucose)) %>% 
  ungroup()

df_ogtt$OGTT <- factor(
  df_ogtt$OGTT, 
  levels = c("BGLUC_PRETEST_MMOLL_LBORRES", "BGLUC_ORAL_1HR_MMOLL_LBORRES", "BGLUC_ORAL_2HR_MMOLL_LBORRES"),
  labels = c("Fast","1hr post","2hr post"))   

plot_ogtt <- df_ogtt %>% 
  ggplot(aes(x = OGTT, y = mean_bg, color = SITE), alpha = 1, size = 0.5) +
  geom_point(shape = 15) +
  geom_line(aes(group = SITE)) + 
  theme_bw() +
  theme(axis.text.x = element_text(angle = 0, vjust = 1, hjust=0.5, size = 9),
        legend.position="right",
        panel.grid.minor = element_blank()) +
  xlab("Enrollment Month") +
  ylab("Frequency") +
  ggtitle("") +
  scale_color_manual(values = c(
    "Ghana" = "#e4d001", "India-CMC" = "#0077b6", "India-SAS" = "#663399",
    "Kenya" = "#b31b1b", "Pakistan" = "#03ac13", "Zambia" = "#f18200"))

plot_ogtt
```

\newpage
## Hemoglobin A1c (HbA1c) test results (MNH08)

### HbA1c (mmol/mol) test results

#### figure 3.9.1.1. HbA1c (mmol/mol) distribution at enrollment by site
```{r}
df_hba1c <- df_lab_08_l %>%
  filter(TYPE_VISIT == 1) %>% 
  select(MOMID, PREGID, SITE, HBA1C_LBORRES) %>% 
  filter(!is.na(HBA1C_LBORRES)) 

df_hba1c %>% 
  ggplot(aes(x = HBA1C_LBORRES)) +
  geom_histogram(alpha = 0.8, binwidth = 0.5, fill = "#F2AD00") +
  xlab ("HbA1c (mmol/mol)") +
  ylab("Frequency") +
  scale_x_continuous(
    breaks = seq(floor(min(df_hba1c$HBA1C_LBORRES)), max(df_hba1c$HBA1C_LBORRES), 
                 max(0.5, floor((max(df_hba1c$HBA1C_LBORRES)-min(df_hba1c$HBA1C_LBORRES))/50)))) +
  facet_grid(SITE ~ ., scales = "free_y") +  
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust= 0.5),
        axis.text = element_text(size = 8), 
        legend.position = "none", 
        panel.grid.minor = element_blank(),
        strip.background=element_rect(fill="white"), 
        strip.text = element_text(size = 8), 
  ) 

```


\newpage
## Red Blood Cell (RBC) Disorder test results (MNH08)

### Sickle cell disease

#### figure 3.10.1.1. Percentage of participants with sickle cell disease at enrollment each site
```{r}
df_sickle <- df_lab_08_l %>%
  filter(TYPE_VISIT == 1) %>%
  select(MOMID, PREGID, SITE, RBC_SICKLE_LBORRES) %>%
  filter(!is.na(RBC_SICKLE_LBORRES)) 

plot_cat_bar(df_sickle, df_sickle$RBC_SICKLE_LBORRES, "Sickle cell disease") 

```

\newpage
### Hemoglobinopathies & Thalassemias

#### figure 3.10.2.1. Percentage of participants with hemoglobinopathies & thalassemias at enrollment each site
```{r}
df_thala <- df_lab_08_l %>%
  filter(TYPE_VISIT == 1) %>%
  select(MOMID, PREGID, SITE, RBC_THALA_LBORRES) %>%
  filter(!is.na(RBC_THALA_LBORRES)) 

plot_cat_bar(df_thala, df_thala$RBC_THALA_LBORRES, "Hemoglobinopathies & Thalassemias") 

```

\newpage
### Glucose-6-Phosphate Dehydrogenase (G6PD)

#### figure 3.10.3.1. Glucose-6-Phosphate Dehydrogenase (G6PD) distribution at enrollment by site
```{r}
df_g6pd <- df_lab_08_l %>%
  filter(TYPE_VISIT == 1) %>% 
  select(MOMID, PREGID, SITE, RBC_G6PD_LBORRES) %>% 
  filter(!is.na(RBC_G6PD_LBORRES)) 

df_g6pd %>% 
  ggplot(aes(x = RBC_G6PD_LBORRES)) +
  geom_histogram(alpha = 0.8, binwidth = 0.5, fill = "#F2AD00") +
  xlab ("G6PD (U/g Hb)") +
  ylab("Frequency") +
  scale_x_continuous(
    breaks = seq(floor(min(df_g6pd$RBC_G6PD_LBORRES)), max(df_g6pd$RBC_G6PD_LBORRES),
                 max(0.5, floor((max(df_g6pd$RBC_G6PD_LBORRES)-min(df_g6pd$RBC_G6PD_LBORRES))/50)))) +
  facet_grid(SITE ~ ., scales = "free_y") +  
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust= 0.5),
        axis.text = element_text(size = 8), 
        legend.position = "none", 
        panel.grid.minor = element_blank(),
        strip.background=element_rect(fill="white"), 
        strip.text = element_text(size = 8), 
  ) 

```

\newpage
## Urinalysis test results (MNH08)

### Protein

#### figure 3.11.1.1. Protein lab results distribution by gestational age (GA) and PNC visits

```{r}
#histogram
df_protein <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, UA_PROT_LBORRES, trimester, time, TYPE_VISIT) %>% 
  filter(!is.na(UA_PROT_LBORRES) & !is.na(time)) 

plot_histo(df_protein, df_protein$UA_PROT_LBORRES, "Protein") 

```

\newpage
### Leukocytes

#### figure 3.11.2.1. Leukocytes lab results distribution by gestational age (GA) and PNC visits
```{r}
#histogram
df_leukocytes <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, UA_LEUK_LBORRES, trimester, time, TYPE_VISIT) %>% 
  filter(!is.na(UA_LEUK_LBORRES) & !is.na(time)) 

plot_histo(df_leukocytes, df_leukocytes$UA_LEUK_LBORRES, "Leukocytes") 

```
\newpage
### Nitrites

#### figure 3.11.3.1. Nitrites lab results distribution by gestational age (GA) and PNC visits
```{r}
#histogram
df_nitrites <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, UA_NITRITE_LBORRES, trimester, time, TYPE_VISIT) %>% 
  filter(!is.na(UA_NITRITE_LBORRES) & !is.na(time)) 

plot_histo(df_nitrites, df_nitrites$UA_NITRITE_LBORRES, "Nitrites") 

```

\newpage
## Tuberculosis (TB) test results (MNH08)

### Gene Xpert/MTB-RIF culture result

#### figure 3.12.1.1. Gene Xpert/MTB-RIF culture results distribution by trimester
```{r}
#histogram
df_tb <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, TB_CNFRM_LBORRES, trimester, time, TYPE_VISIT) %>% 
  filter(!is.na(TB_CNFRM_LBORRES) & !is.na(time)) 

plot_bar(df_tb, df_tb$TB_CNFRM_LBORRES, "Gene Xpert/MTB-RIF")

```

\newpage
### Gene Xpert/MTB-RIF backup culture result

#### figure 3.12.2.1. Gene Xpert/MTB-RIF backup culture results distribution by gestational age (GA) and PNC visits
```{r}
# histogram
df_tb_backup <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, TB_BACKUP_LBORRES, trimester, time, TYPE_VISIT) %>%
  filter(!is.na(TB_BACKUP_LBORRES) & !is.na(time)) 

plot_bar(df_tb_backup, df_tb_backup$TB_BACKUP_LBORRES, "Gene Xpert/MTB-RIF backup") + 
  scale_x_discrete(limits = seq(1,3,1))

```

\newpage
## Chlamydia and Gonorrhea test results (MNH08)

### Chlamydia test results

#### figure 3.13.1.1. Chlamydia test results distribution by gestational age (GA) 
```{r}
#histogram
df_chlamydia <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, CTNG_CT_LBORRES, trimester, time, TYPE_VISIT) %>%
  filter(!is.na(CTNG_CT_LBORRES) & !is.na(time))

if (nrow(df_chlamydia) > 0) {
  plot_histo(df_chlamydia, df_chlamydia$CTNG_CT_LBORRES, "Chlamydia")
} else {print("Figure will be generated when more data points are available")}


```

\newpage
### Gonorrhea test results

#### figure 3.13.2.1. Gonorrhea test results distribution by gestational age (GA) 
```{r}
#histogram
df_gonorrhea <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, CTNG_NG_LBORRES, trimester, time, TYPE_VISIT) %>%
  filter(!is.na(CTNG_NG_LBORRES) & !is.na(time))

if (nrow(df_gonorrhea) > 0) {
  plot_histo(df_gonorrhea, df_gonorrhea$CTNG_NG_LBORRES, "Gonorrhea")
} else {print("Figure will be generated when more data points are available")}

```

\newpage
## Syphilis Titers test results (MNH08)

### Syphilis Titers test results

#### figure 3.14.1.1. Syphilis Titers test results distribution at ANC32 by site
```{r}
#Districution at ANC32
df_syphilis <- df_lab_08_l %>%
  filter(TYPE_VISIT == 4) %>%
  select(MOMID, PREGID, SITE, SYPH_TITER_LBORRES) %>%
  filter(!is.na(SYPH_TITER_LBORRES))

if (nrow(df_syphilis) > 0) {
  plot_cat_bar(df_syphilis, df_syphilis$SYPH_TITER_LBORRES, "Syphilis Titers")
} else {print("Figure will be generated when more data points are available")}

```

\newpage
### Syphilis titers highest positive dilution results

#### figure 3.14.2.1. Syphilis titers highest positive dilution results distribution at ANC32 by site
```{r}
#histogram
df_syphilis_dilu <- df_lab_08_l %>%
  filter(TYPE_VISIT == 4) %>%
  select(MOMID, PREGID, SITE, SYPH_TITER_RATIO_LBORRES) %>%
  filter(!is.na(SYPH_TITER_RATIO_LBORRES))

df_syphilis_dilu %>%
  ggplot(aes(x = SYPH_TITER_RATIO_LBORRES)) +
  geom_histogram(alpha = 0.8, binwidth = 1, fill = "#00A08A") +
  xlab ("Syphilis titers highest positive dilution results (1:xx)") +
  ylab("Frequency") +
  scale_x_continuous(
    breaks = seq(floor(min(df_syphilis_dilu$SYPH_TITER_RATIO_LBORRES)), max(df_syphilis_dilu$SYPH_TITER_RATIO_LBORRES), max(0.5, floor((max(df_syphilis_dilu$SYPH_TITER_RATIO_LBORRES)-min(df_syphilis_dilu$SYPH_TITER_RATIO_LBORRES))/50)))) +
  facet_grid(SITE ~ ., scales = "free_y") +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust= 0.5),
        axis.text = element_text(size = 8),
        legend.position = "none",
        panel.grid.minor = element_blank(),
        strip.background=element_rect(fill="white"),
        strip.text = element_text(size = 8),
  )


```

\newpage
## Zika-Dengue-Chikungunya (ZCD) IgM/IgG test results (MNH08)

### ZIKV IgM test results

#### figure 3.15.1.1. Gonorrhea test results distribution by gestational age (GA) and PNC visits
```{r}
#histogram
df_zikv_igm <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, ZCD_ZIKIGM_LBORRES, trimester, time, TYPE_VISIT) %>%
  filter(!is.na(ZCD_ZIKIGM_LBORRES) & !is.na(time))

if (nrow(df_zikv_igm) > 0) {
  plot_histo(df_zikv_igm, df_zikv_igm$ZCD_ZIKIGM_LBORRES, "ZIKV IgM")
} else {print("Figure will be generated when more data points are available")}

```

\newpage
### ZIKV IgG test results

#### figure 3.15.2.1. Gonorrhea test results distribution by gestational age (GA) and PNC visits
```{r}
#histogram
df_zikv_igg <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, ZCD_ZIKIGG_LBORRES, trimester, time, TYPE_VISIT) %>%
  filter(!is.na(ZCD_ZIKIGG_LBORRES) & !is.na(time))

if (nrow(df_zikv_igg) > 0) {
  plot_histo(df_zikv_igg, df_zikv_igg$ZCD_ZIKIGG_LBORRES, "ZIKV IgG")
} else {print("Figure will be generated when more data points are available")}

```

\newpage
### DENV IgM test results

#### figure 3.15.3.1. Gonorrhea test results distribution by gestational age (GA) and PNC visits
```{r}
#histogram
df_denv_igm <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, ZCD_DENIGM_LBORRES, trimester, time, TYPE_VISIT) %>%
  filter(!is.na(ZCD_DENIGM_LBORRES) & !is.na(time))

if (nrow(df_denv_igm) > 0) {
  plot_histo(df_denv_igm, df_denv_igm$ZCD_DENIGM_LBORRES, "DENV IgM")
} else {print("Figure will be generated when more data points are available")}

```

\newpage
### DENV IgG test results

#### figure 3.15.4.1. Gonorrhea test results distribution by gestational age (GA) and PNC visits
```{r}
#histogram
df_denv_igg <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, ZCD_DENIGG_LBORRES, trimester, time, TYPE_VISIT) %>%
  filter(!is.na(ZCD_DENIGG_LBORRES) & !is.na(time))

if (nrow(df_denv_igg) > 0) {
  plot_histo(df_denv_igg, df_denv_igg$ZCD_DENIGG_LBORRES, "DENV IgG")
} else {print("Figure will be generated when more data points are available")}

```

\newpage
### CHKV IgM test results

#### figure 3.15.5.1. Gonorrhea test results distribution by gestational age (GA) and PNC visits
```{r}
#histogram
df_chkv_igm <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, ZCD_CHKIGM_LBORRES, trimester, time, TYPE_VISIT) %>%
  filter(!is.na(ZCD_CHKIGM_LBORRES) & !is.na(time))

if (nrow(df_chkv_igm) > 0) {
  plot_histo(df_chkv_igm, df_chkv_igm$ZCD_CHKIGM_LBORRES, "CHKV IgM")
} else {print("Figure will be generated when more data points are available")}

```

\newpage
### CHKV IgG test results

#### figure 3.15.6.1. Gonorrhea test results distribution by gestational age (GA) and PNC visits
```{r}
#histogram
df_chkv_igg <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, ZCD_CHKIGG_LBORRES, trimester, time, TYPE_VISIT) %>%
  filter(!is.na(ZCD_CHKIGG_LBORRES) & !is.na(time))

if (nrow(df_chkv_igg) > 0) {
  plot_histo(df_chkv_igg, df_chkv_igg$ZCD_CHKIGG_LBORRES, "CHKV IgG")
} else {print("Figure will be generated when more data points are available")}

```

\newpage
## Leptospirosis IgM/IgG test results (MNH08)

### Leptospirosis IgM test results

#### figure 3.15.6.1. Leptospirosis IgM test results distribution by gestational age (GA) and PNC visits
```{r}
#histogram
df_Lep_igm <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, LEPT_IGM_LBORRES, trimester, time, TYPE_VISIT) %>%
  filter(!is.na(LEPT_IGM_LBORRES) & !is.na(time))

if (nrow(df_Lep_igm) > 0) {
  plot_histo(df_Lep_igm, df_Lep_igm$LEPT_IGM_LBORRES, "Leptospirosis IgM")
} else {print("Figure will be generated when more data points are available")}

```

\newpage
### Leptospirosis IgG test results

#### figure 3.15.6.1. Leptospirosis IgG test results distribution by gestational age (GA) and PNC visits
```{r}
#histogram
df_Lep_igg <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, LEPT_IGG_LBORRES, trimester, time, TYPE_VISIT) %>%
  filter(!is.na(LEPT_IGG_LBORRES) & !is.na(time))

if (nrow(df_Lep_igg) > 0) {
  plot_histo(df_Lep_igg, df_Lep_igg$LEPT_IGG_LBORRES, "Leptospirosis IgG")
} else {print("Figure will be generated when more data points are available")}

```

\newpage
## Hepatitis E IgM/IgG test results (MNH08)

### HEV IgM test results

#### figure 3.15.6.1. HEV IgM test results test results distribution by gestational age (GA) and PNC visits
```{r}
#histogram
df_hev_igm <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, HEV_IGM_LBORRES, trimester, time, TYPE_VISIT) %>%
  filter(!is.na(HEV_IGM_LBORRES) & !is.na(time))

if (nrow(df_hev_igm) > 0) {
  plot_histo(df_hev_igm, df_hev_igm$HEV_IGM_LBORRES, "HEV IgM")
} else {print("Figure will be generated when more data points are available")}

```

\newpage
### HEV IgG test results

#### figure 3.15.6.1. HEV IgG test results distribution by gestational age (GA) and PNC visits
```{r}
#histogram
df_hev_igg <- df_lab_08_l %>%
  select(MOMID, PREGID, SITE, ga_wks, HEV_IGG_LBORRES, trimester, time, TYPE_VISIT) %>%
  filter(!is.na(HEV_IGG_LBORRES) & !is.na(time))

if (nrow(df_hev_igg) > 0) {
  plot_histo(df_hev_igg, df_hev_igg$HEV_IGG_LBORRES, "HEV IgG")
} else {print("Figure will be generated when more data points are available")}

```